"use strict";!function(e){var o=e.module("educ.ngJsonRpc",[]);o.service("JsonRpc",["$q","$timeout","$http",function(e,o,t){function r(e,o){return{error:e,module:"JsonRpcService",method:o}}function l(e){this.url=e,this.timeout=6e4}this.entrypoint=function(e){return new l(e)};var n=0;l.prototype.call=function(l,c){var s={id:++n,method:l,params:c},i=JSON.stringify(s);console.log("JSON-RPC",s.id,"POST",this.url),console.log("JSON-RPC",s.id,"->",i);var u=e.defer(),d=e.defer(),a=!1;d.promise.then(function(e){a=e});var m=o(function(){d.resolve({status:"timeout"})},this.timeout);return t({method:"POST",url:this.url,data:i,timeout:d.promise,withCredentials:!0}).success(function(e){o.cancel(m),e?(void 0!==e.debug&&null!==e.debug&&e.debug.length>0&&console.error("debug",e.debug),void 0!==e.error&&null!==e.error?(console.log("JSON-RPC",s.id,"<- NOK",e.error),u.reject(r(e.error,s.method))):void 0!==e.result&&null!==e.result?(console.log("JSON-RPC",s.id,"<- OK",e.result),u.resolve(e.result)):(console.log("JSON-RPC",s.id,"<- NOK",e),u.reject(r("bad-response","call")))):(console.log("JSON-RPC",s.id,"<- NOK",e),u.reject(r("empty-response","call")))}).error(function(e,t){o.cancel(m),"canceled"===a.status?(console.log("JSON-RPC",s.id,"<- NOK","(canceled)"),u.reject(r("canceled","call"))):"timeout"===a.status?(console.log("JSON-RPC",s.id,"<- NOK","(timeout)"),u.reject(r("timeout","call"))):(console.log("JSON-RPC",s.id,"<- NOK status",e),u.reject(r(t,"call")))}),{request:s,promise:u.promise,abort:function(){d.resolve({status:"canceled"}),o.cancel(m)}}}}])}(angular);